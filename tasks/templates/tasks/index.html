<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Task Analyzer</title>
    <style>
        :root {
            --primary: #2563eb;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --danger: #ef4444; 
            --warning: #f59e0b; 
            --success: #10b981; 
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: #1e293b;
            margin: 0;
            padding: 2rem;
            line-height: 1.5;
        }

        .container { max-width: 1000px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 3rem; }
        h1 { font-size: 2.5rem; color: #0f172a; margin-bottom: 0.5rem; }
        p.subtitle { color: #64748b; font-size: 1.1rem; }

        .grid { display: grid; grid-template-columns: 1fr 1.5fr; gap: 2rem; }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .form-group { margin-bottom: 1rem; }
        label { display: block; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.9rem; }
        
        input, select {
            width: 100%; padding: 0.75rem; border: 1px solid #cbd5e1;
            border-radius: 6px; font-size: 1rem; box-sizing: border-box;
        }

        button.btn-analyze {
            width: 100%; background-color: var(--primary); color: white;
            border: none; padding: 1rem; font-size: 1rem; font-weight: bold;
            border-radius: 8px; cursor: pointer; transition: background 0.2s;
            margin-top: 1rem;
        }
        button.btn-analyze:hover { background-color: #1d4ed8; }

        /* Pending List Styles */
        #pending-list { margin-top: 1.5rem; border-top: 1px solid #e2e8f0; padding-top: 1rem; }
        .pending-item {
            display: flex; justify-content: space-between; align-items: center;
            background: #f1f5f9; padding: 0.75rem; border-radius: 6px; margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        .btn-delete {
            color: #ef4444; background: none; border: none; cursor: pointer; font-weight: bold; font-size: 1.2rem;
        }

        /* Results List */
        #results-area { display: flex; flex-direction: column; gap: 1rem; }
        .task-card {
            border-left: 6px solid #ccc; padding: 1rem; background: #fff;
            border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: flex; justify-content: space-between; align-items: center;
        }

        .priority-high { border-left-color: var(--danger); background-color: #fef2f2; }
        .priority-med { border-left-color: var(--warning); }
        .priority-low { border-left-color: var(--success); }

        .score-badge { font-size: 1.25rem; font-weight: 800; color: #334155; }
        .task-details h3 { margin: 0 0 0.25rem 0; font-size: 1.1rem; }
        .task-meta { font-size: 0.85rem; color: #64748b; }

        .toggle-link {
            display: block; text-align: center; margin-top: 1rem;
            color: var(--primary); cursor: pointer; font-size: 0.9rem; text-decoration: underline;
        }
        #json-input-area { display: none; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Smart Task Analyzer</h1>
        <p class="subtitle">Prioritize your workload using weighted scoring algorithms</p>
    </header>

    <div class="grid">
        <div class="input-section">
            <div class="card">
                <div class="form-group">
                    <label>Strategy Logic</label>
                    <select id="strategy-select">
                        <option value="balanced">‚öñÔ∏è Smart Balance (Recommended)</option>
                        <option value="deadline">üìÖ Deadline Driven</option>
                        <option value="fastest">‚ö° Fastest Wins (Low Effort)</option>
                        <option value="impact">‚≠ê High Impact (Importance)</option>
                    </select>
                </div>

                <hr style="border: 0; border-top: 1px solid #e2e8f0; margin: 1.5rem 0;">

                <div id="standard-form">
                    <div class="form-group">
                        <label>Task Title</label>
                        <input type="text" id="t-title" placeholder="e.g. Fix Login Bug">
                    </div>
                    <div class="form-group">
                        <label>Due Date</label>
                        <input type="date" id="t-date">
                    </div>
                    <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label>Importance (1-10)</label>
                            <input type="number" id="t-imp" min="1" max="10" value="5">
                        </div>
                        <div class="form-group">
                            <label>Est. Hours</label>
                            <input type="number" id="t-hours" min="0.1" step="0.5" value="1">
                        </div>
                    </div>
                    <button class="btn-analyze" onclick="addTask()">+ Add to List</button>
                    
                    <div id="pending-list">
                        <div style="text-align: center; color: #94a3b8; font-size: 0.9rem;">
                            No tasks added yet.
                        </div>
                    </div>
                </div>

                <div id="json-input-area">
                    <div class="form-group">
                        <label>Paste JSON Array</label>
                        <textarea id="json-raw" rows="8" style="width:100%; padding:0.5rem; border-radius:6px; border:1px solid #ccc;"></textarea>
                    </div>
                    <button class="btn-analyze" onclick="loadFromJson()">Load JSON</button>
                </div>

                <span class="toggle-link" onclick="toggleInputMode()">Switch to JSON / Bulk Input</span>
            </div>

            <button class="btn-analyze" style="margin-top: 1rem; background-color: #0f172a;" onclick="analyzeQueue()">
                üöÄ Analyze & Prioritize
            </button>
        </div>

        <div class="output-section">
            <h2 style="margin-top: 0;">Priority Queue</h2>
            <div id="results-area">
                <div style="text-align: center; padding: 2rem; color: #94a3b8;">
                    Added tasks will appear here after analysis.
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let taskQueue = [];

    // Date Picker Min Value on Load
    window.onload = function() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('t-date').min = today;
    };

    function toggleInputMode() {
        const std = document.getElementById('standard-form');
        const json = document.getElementById('json-input-area');
        if (std.style.display === 'none') {
            std.style.display = 'block';
            json.style.display = 'none';
        } else {
            std.style.display = 'none';
            json.style.display = 'block';
        }
    }

    function addTask() {
        const title = document.getElementById('t-title').value;
        if (!title) return alert("Task needs a title at least.");

        // Date Validation
        const dateInput = document.getElementById('t-date').value;
        if (dateInput) {
            const selectedDate = new Date(dateInput);
            const today = new Date();
            today.setHours(0,0,0,0);
            if (selectedDate < today) {
                return alert("Please select a future date or leave blank.");
            }
        }

        const task = {
            id: Date.now(), 
            title: title,
            due_date: dateInput || null,
            importance: parseInt(document.getElementById('t-imp').value),
            estimated_hours: parseFloat(document.getElementById('t-hours').value),
            dependencies: [] 
        };

        taskQueue.push(task);
        renderPendingList();
        
       
        document.getElementById('t-title').value = '';
        document.getElementById('t-date').value = '';
        document.getElementById('t-imp').value = 5;
    }

 
    function renderPendingList() {
        const container = document.getElementById('pending-list');
        
        if (taskQueue.length === 0) {
            container.innerHTML = '<div style="text-align: center; color: #94a3b8; font-size: 0.9rem;">No tasks added yet.</div>';
            return;
        }

        let html = '<label>Pending Tasks (' + taskQueue.length + ')</label>';
        taskQueue.forEach(task => {
            html += `
                <div class="pending-item">
                    <span>${task.title}</span>
                    <button class="btn-delete" onclick="removeTask(${task.id})">&times;</button>
                </div>
            `;
        });
        container.innerHTML = html;
    }

    
    function removeTask(id) {
        taskQueue = taskQueue.filter(t => t.id !== id);
        renderPendingList();
    }

    async function analyzeQueue() {
        if (taskQueue.length === 0) return alert("Add some tasks first!");

        const strategy = document.getElementById('strategy-select').value;
        const resultsArea = document.getElementById('results-area');
        
        resultsArea.innerHTML = '<div style="text-align:center; padding:2rem;">Calculating scores...</div>';

        try {
            const response = await fetch('/api/tasks/analyze/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    tasks: taskQueue,
                    strategy: strategy
                })
            });

            const data = await response.json();
            
            if (data.status === 'success') {
                renderResults(data.tasks);
            } else {
                alert("Backend error: " + data.message);
            }

        } catch (e) {
            console.error(e);
            resultsArea.innerHTML = '<div style="color:red; text-align:center;">Failed to connect to server.</div>';
        }
    }

    function renderResults(tasks) {
        const container = document.getElementById('results-area');
        container.innerHTML = '';

        tasks.forEach(task => {
            let priorityClass = 'priority-low';
            if (task.score > 80) priorityClass = 'priority-high';
            else if (task.score > 40) priorityClass = 'priority-med';

            const html = `
                <div class="task-card ${priorityClass}">
                    <div class="task-details">
                        <h3>${task.title}</h3>
                        <div class="task-meta">
                            Due: ${task.due_date || 'No Date'} ‚Ä¢ 
                            Imp: ${task.importance}/10 ‚Ä¢ 
                            ${task.estimated_hours}h
                        </div>
                    </div>
                    <div class="score-badge">
                        ${task.score}
                    </div>
                </div>
            `;
            container.innerHTML += html;
        });
    }

    function loadFromJson() {
        const raw = document.getElementById('json-raw').value;
        try {
            const tasks = JSON.parse(raw);
            if (Array.isArray(tasks)) {
                taskQueue = tasks.map(t => ({...t, id: Date.now() + Math.random()}));
                renderPendingList();
                toggleInputMode(); 
                alert(`Loaded ${taskQueue.length} tasks from JSON`);
            } else {
                alert("JSON must be an array of objects");
            }
        } catch(e) {
            alert("Invalid JSON");
        }
    }
</script>

</body>
</html>